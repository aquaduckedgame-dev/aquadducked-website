<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AquaDucked! - A Physics Puzzle Game</title>

    <!-- App Links for Android -->
    <meta property="al:android:url" content="aquaducked://level/">
    <meta property="al:android:package" content="com.nick.aquaducked">
    <meta property="al:android:app_name" content="AquaDucked!">
    <meta property="al:web:url" content="https://aquaduckedgame.com">

    <!-- Open Graph for sharing -->
    <meta property="og:title" content="AquaDucked! - A Physics Puzzle Game">
    <meta property="og:description" content="Guide your rubber duck to safety using hoses, slides, trampolines and more! Create and share your own levels.">
    <meta property="og:image" content="https://aquaduckedgame.com/logo.png">
    <meta property="og:url" content="https://aquaduckedgame.com">
    <meta property="og:type" content="website">

    <link rel="icon" type="image/png" href="logo.png">

    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0d1926;
            min-height: 100vh;
            color: #fff;
            overflow-x: hidden;
        }

        /* Water wave animation at bottom */
        .water-bg {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 150px;
            background: linear-gradient(to bottom, transparent, rgba(32, 128, 192, 0.3));
            pointer-events: none;
            z-index: 0;
        }

        .water-bg::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: -50%;
            right: -50%;
            height: 80px;
            background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 120'%3E%3Cpath fill='rgba(64,160,220,0.4)' d='M0,60 C300,120 600,0 900,60 C1050,90 1150,30 1200,60 L1200,120 L0,120 Z'/%3E%3C/svg%3E") repeat-x;
            animation: wave 15s ease-in-out infinite;
        }

        .water-bg::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: -50%;
            right: -50%;
            height: 60px;
            background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 120'%3E%3Cpath fill='rgba(32,128,192,0.5)' d='M0,60 C300,0 600,120 900,60 C1050,30 1150,90 1200,60 L1200,120 L0,120 Z'/%3E%3C/svg%3E") repeat-x;
            animation: wave 15s ease-in-out infinite;
            animation-delay: -7.5s;
        }

        @keyframes wave {
            0%, 100% { transform: translateX(-10%); }
            50% { transform: translateX(10%); }
        }

        /* Main container */
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 20px;
            position: relative;
            z-index: 1;
        }

        /* Header */
        header {
            text-align: center;
            margin-bottom: 50px;
        }

        .logo {
            max-width: 500px;
            width: 90%;
            height: auto;
            margin-bottom: 10px;
        }

        h1 {
            font-size: 3.5rem;
            color: #ffd700;
            text-shadow: 0 2px 10px rgba(255, 215, 0, 0.3);
            margin-bottom: 10px;
        }

        /* Hero section */
        .hero {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 40px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .hero p {
            font-size: 1.2rem;
            line-height: 1.8;
            color: #ccd;
            margin-bottom: 20px;
        }

        /* Features Showcase */
        .features-showcase {
            max-width: 1000px;
            margin: 40px auto;
            padding: 0 20px;
        }

        .feature-row {
            display: flex;
            align-items: center;
            gap: 30px;
            margin-bottom: 40px;
        }

        .feature-row.reverse {
            flex-direction: row-reverse;
        }

        .feature-image {
            flex: 1;
            max-width: 350px;
        }

        .feature-image img {
            width: 100%;
            max-height: 200px;
            object-fit: contain;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            cursor: pointer;
            transition: transform 0.2s;
        }

        .feature-image img:hover {
            transform: scale(1.03);
        }

        .feature-text {
            flex: 1;
        }

        .feature-text h3 {
            font-size: 1.5rem;
            color: #ffd700;
            margin-bottom: 10px;
        }

        .feature-text p {
            font-size: 1.1rem;
            color: #ccd;
            line-height: 1.6;
        }

        /* Lightbox */
        .lightbox {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 1000;
            cursor: pointer;
            justify-content: center;
            align-items: center;
        }

        .lightbox.active {
            display: flex;
        }

        .lightbox img {
            max-width: 95%;
            max-height: 95%;
            object-fit: contain;
            border-radius: 8px;
        }

        /* Download buttons */
        .download-section {
            text-align: center;
            margin: 40px 0;
        }

        .download-btn {
            display: inline-flex;
            align-items: center;
            gap: 12px;
            background: linear-gradient(135deg, #ffd700, #ffaa00);
            color: #1a1a2e;
            padding: 18px 40px;
            font-size: 1.3rem;
            font-weight: bold;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            text-decoration: none;
            transition: transform 0.3s, box-shadow 0.3s;
            box-shadow: 0 4px 20px rgba(255, 215, 0, 0.3);
        }

        .download-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 30px rgba(255, 215, 0, 0.4);
        }

        .download-btn.secondary {
            background: linear-gradient(135deg, #4a9eff, #2080dd);
            color: white;
            box-shadow: 0 4px 20px rgba(74, 158, 255, 0.3);
        }

        .download-btn.secondary:hover {
            box-shadow: 0 6px 30px rgba(74, 158, 255, 0.4);
        }

        .btn-icon {
            font-size: 1.5rem;
        }

        .download-note {
            margin-top: 15px;
            color: #889;
            font-size: 0.9rem;
        }

        /* The Pond section */
        .pond-section {
            background: rgba(255, 215, 0, 0.1);
            border-radius: 20px;
            padding: 40px;
            margin: 40px 0;
            border: 1px solid rgba(255, 215, 0, 0.2);
            text-align: center;
        }

        .pond-section h2 {
            color: #ffd700;
            font-size: 2rem;
            margin-bottom: 15px;
        }

        .pond-section p {
            color: #ccd;
            font-size: 1.1rem;
            margin-bottom: 20px;
        }

        /* QR Code redirect overlay */
        .qr-redirect-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(13, 25, 38, 0.98);
            z-index: 100;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .qr-redirect-overlay.active {
            display: flex;
        }

        .qr-redirect-card {
            background: linear-gradient(135deg, #1a3a5a, #0d1926);
            border-radius: 25px;
            padding: 50px;
            text-align: center;
            max-width: 500px;
            border: 2px solid rgba(255, 215, 0, 0.3);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .qr-redirect-card .logo {
            width: 120px;
            height: 120px;
        }

        .qr-redirect-card h2 {
            color: #ffd700;
            font-size: 1.8rem;
            margin: 20px 0;
        }

        .qr-redirect-card p {
            color: #aab;
            font-size: 1.1rem;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .qr-redirect-card .level-name {
            background: rgba(135, 206, 235, 0.2);
            padding: 15px 25px;
            border-radius: 10px;
            color: #87ceeb;
            font-size: 1.2rem;
            margin-bottom: 30px;
            word-break: break-all;
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 40px 20px;
            color: #667;
            font-size: 0.9rem;
        }

        footer a {
            color: #87ceeb;
            text-decoration: none;
        }

        footer a:hover {
            text-decoration: underline;
        }

        /* Featured Level Card */
        .featured-level {
            margin-top: 20px;
        }

        .featured-card {
            display: flex;
            align-items: center;
            gap: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            max-width: 500px;
            margin: 0 auto;
            text-align: left;
        }

        .featured-thumb {
            width: 120px;
            height: 68px;
            object-fit: cover;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
        }

        .featured-info {
            flex: 1;
        }

        .featured-info h3 {
            color: #fff;
            font-size: 1.2rem;
            margin-bottom: 5px;
        }

        .featured-info p {
            color: #aab;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .featured-meta {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .difficulty-badge {
            background: #4a9eff;
            color: white;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .difficulty-badge.easy { background: #4CAF50; }
        .difficulty-badge.medium { background: #FF9800; }
        .difficulty-badge.hard { background: #f44336; }
        .difficulty-badge.expert { background: #9C27B0; }

        .likes-count {
            color: #ff6b6b;
            font-size: 0.9rem;
        }

        .featured-play-btn {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 0.95rem;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .featured-play-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.4);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .feature-row,
            .feature-row.reverse {
                flex-direction: column;
            }

            .feature-image {
                max-width: 100%;
            }

            .feature-text {
                text-align: center;
            }
        }

        @media (max-width: 600px) {
            h1 {
                font-size: 2.5rem;
            }

            .hero, .pond-section {
                padding: 25px;
            }

            .download-btn {
                padding: 15px 30px;
                font-size: 1.1rem;
            }

            .qr-redirect-card {
                padding: 30px;
            }

            .featured-card {
                flex-direction: column;
                text-align: center;
            }

            .featured-thumb {
                width: 160px;
                height: 90px;
            }

            .featured-meta {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- Water background animation -->
    <div class="water-bg"></div>

    <!-- Lightbox for expanded images -->
    <div class="lightbox" id="lightbox">
        <img src="" alt="Expanded view" id="lightbox-img">
    </div>

    <!-- QR Code Redirect Overlay -->
    <div id="qrRedirect" class="qr-redirect-overlay">
        <div class="qr-redirect-card">
            <img src="logo_transparent.png" alt="AquaDucked!" class="logo">
            <h2>Level Shared With You!</h2>
            <div id="levelInfo" class="level-name" style="display: none;"></div>
            <p>Someone shared an AquaDucked! level with you. Get the app to play it!</p>
            <a href="#" id="storeLink" class="download-btn">
                <span class="btn-icon">üì±</span>
                Get AquaDucked!
            </a>
            <p class="download-note" style="margin-top: 20px;">
                <a href="/" style="color: #87ceeb;">‚Üê Back to website</a>
            </p>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container">
        <header>
            <img src="logo_transparent.png" alt="AquaDucked!" class="logo">
        </header>

        <section class="hero">
            <p>
                Help your rubber duck follow Mama Duck through 10 worlds of adventure and challenge!
                Strategically place hoses, slides, trampolines, fans, and more during the planning phase,
                then watch the physics unfold as your duck bounces, slides, and splashes its way towards Mama.
            </p>

            <!-- Features with screenshots -->
            <div class="features-showcase">
                <div class="feature-row">
                    <div class="feature-image">
                        <img src="Editor.png" alt="Level Editor">
                    </div>
                    <div class="feature-text">
                        <h3>üé® Level Editor</h3>
                        <p>Build your own puzzles with an intuitive drag-and-drop editor. Choose from platforms, slides, hoses, trampolines, fans, and more.</p>
                    </div>
                </div>

                <div class="feature-row reverse">
                    <div class="feature-image">
                        <img src="Hello_Share.png" alt="Share Levels">
                    </div>
                    <div class="feature-text">
                        <h3>üì§ Share Levels</h3>
                        <p>Share your creations with a QR code. Friends can scan and play your level instantly‚Äîno account needed.</p>
                    </div>
                </div>

                <div class="feature-row">
                    <div class="feature-image">
                        <img src="Physics.png" alt="Physics Fun">
                    </div>
                    <div class="feature-text">
                        <h3>üéà Physics Fun</h3>
                        <p>Realistic water, bouncy trampolines, floating balloons, and rope swings. Watch your duck splash, bounce, and float to the goal.</p>
                    </div>
                </div>

                <div class="feature-row reverse">
                    <div class="feature-image">
                        <img src="Pond.png" alt="The Pond">
                    </div>
                    <div class="feature-text">
                        <h3>üåä The Pond</h3>
                        <p>Browse and play community levels from players around the world. Filter by difficulty, search by name, and favorite the best ones.</p>
                    </div>
                </div>
            </div>
        </section>

        <section class="download-section">
            <a href="#" id="mainDownloadBtn" class="download-btn">
                <span class="btn-icon">üì±</span>
                Download for Android
            </a>
            <p class="download-note">Coming soon to Google Play Store</p>
        </section>

        <section class="pond-section">
            <h2>üåä The Pond</h2>
            <p>
                Discover thousands of community-created levels right in the game!
                Browse, play, and share your favorites. Create your own levels
                with the built-in editor and upload them for the world to enjoy.
            </p>

            <!-- Featured Level -->
            <div id="featuredLevel" class="featured-level" style="display: none;">
                <p style="color: #ffd700; font-size: 1.1rem; margin-top: 20px; margin-bottom: 15px;">
                    <span id="featuredLabel">üèÜ This Week's Most Popular Level:</span>
                </p>
                <div class="featured-card">
                    <img id="featuredThumb" src="" alt="Level thumbnail" class="featured-thumb">
                    <div class="featured-info">
                        <h3 id="featuredTitle">Level Name</h3>
                        <p id="featuredAuthor">by Author</p>
                        <div class="featured-meta">
                            <span id="featuredDifficulty" class="difficulty-badge">Medium</span>
                            <span id="featuredLikes" class="likes-count">‚ù§Ô∏è 0</span>
                        </div>
                        <button id="featuredPlayBtn" class="featured-play-btn">‚ñ∂ Play Level</button>
                    </div>
                </div>
            </div>

            <p style="color: #889; font-size: 0.95rem; margin-top: 20px;">
                The Pond is accessible from the main menu in-game.
            </p>
        </section>

        <footer>
            <p>ü¶Ü A game by NickTheDuck ü¶Ü</p>
            <p style="margin-top: 10px;">
                <a href="mailto:aquaduckedgame@gmail.com">Contact</a> ¬∑
                <a href="/privacy.html">Privacy Policy</a>
            </p>
        </footer>
    </div>

    <script>
        // Lightbox functionality
        const lightbox = document.getElementById('lightbox');
        const lightboxImg = document.getElementById('lightbox-img');

        document.querySelectorAll('.feature-image img').forEach(img => {
            img.addEventListener('click', () => {
                lightboxImg.src = img.src;
                lightbox.classList.add('active');
            });
        });

        lightbox.addEventListener('click', () => {
            lightbox.classList.remove('active');
        });

        // Detect if this is a level share link
        function checkForLevelLink() {
            const path = window.location.pathname;
            const params = new URLSearchParams(window.location.search);

            let levelData = null;

            if (path.startsWith('/level/')) {
                levelData = path.substring(7);
            } else if (params.has('level')) {
                levelData = params.get('level');
            }

            if (levelData) {
                showQRRedirect(levelData);
            }
        }

        function showQRRedirect(levelData) {
            const overlay = document.getElementById('qrRedirect');
            const levelInfo = document.getElementById('levelInfo');
            const storeLink = document.getElementById('storeLink');

            if (/^\d+$/.test(levelData)) {
                levelInfo.style.display = 'none';
            } else {
                levelInfo.textContent = 'Shared Level';
                levelInfo.style.display = 'block';
            }

            const userAgent = navigator.userAgent.toLowerCase();
            const isAndroid = userAgent.includes('android');
            const isIOS = /iphone|ipad|ipod/.test(userAgent);

            if (isAndroid) {
                storeLink.href = 'https://play.google.com/store/apps/details?id=com.nick.aquaducked';
                storeLink.innerHTML = '<span class="btn-icon">‚ñ∂Ô∏è</span> Get on Google Play';

                const appLink = 'aquaducked://level/' + levelData;
                setTimeout(() => {
                    window.location.href = appLink;
                }, 100);
            } else if (isIOS) {
                storeLink.href = '#';
                storeLink.innerHTML = '<span class="btn-icon">üçé</span> Coming to iOS';
            } else {
                storeLink.href = '#';
                storeLink.innerHTML = '<span class="btn-icon">üì±</span> Available on Mobile';
            }

            overlay.classList.add('active');
        }

        function updateDownloadButton() {
            const btn = document.getElementById('mainDownloadBtn');
            const userAgent = navigator.userAgent.toLowerCase();
            const isAndroid = userAgent.includes('android');
            const isIOS = /iphone|ipad|ipod/.test(userAgent);

            if (isAndroid) {
                btn.href = 'https://play.google.com/store/apps/details?id=com.nick.aquaducked';
                btn.innerHTML = '<span class="btn-icon">‚ñ∂Ô∏è</span> Get on Google Play';
            } else if (isIOS) {
                btn.href = '#';
                btn.innerHTML = '<span class="btn-icon">üçé</span> Coming to iOS';
            }
        }

        // Supabase config for fetching featured level
        const SUPABASE_URL = 'https://nobrtuawmmdkympdbdti.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5vYnJ0dWF3bW1ka3ltcGRiZHRpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQzODEzNzMsImV4cCI6MjA3OTk1NzM3M30.ecEYYUtd1X8QCD3pKAYUuj-clrCd7ObX-SQR2vVnRNY';

        let featuredLevelId = null;

        async function fetchFeaturedLevel() {
            try {
                // Try to get this week's most popular first
                const oneWeekAgo = new Date();
                oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
                const weekFilter = oneWeekAgo.toISOString();

                let url = `${SUPABASE_URL}/rest/v1/levels?select=id,title,author_name,difficulty,likes_count,thumbnail_url&created_at=gte.${weekFilter}&order=likes_count.desc&limit=1`;

                let response = await fetch(url, {
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Authorization': 'Bearer ' + SUPABASE_ANON_KEY
                    }
                });

                let data = await response.json();
                let isWeekly = true;

                // Fallback to all-time if no weekly results
                if (!data || data.length === 0) {
                    url = `${SUPABASE_URL}/rest/v1/levels?select=id,title,author_name,difficulty,likes_count,thumbnail_url&order=likes_count.desc&limit=1`;
                    response = await fetch(url, {
                        headers: {
                            'apikey': SUPABASE_ANON_KEY,
                            'Authorization': 'Bearer ' + SUPABASE_ANON_KEY
                        }
                    });
                    data = await response.json();
                    isWeekly = false;
                }

                if (data && data.length > 0) {
                    displayFeaturedLevel(data[0], isWeekly);
                }
            } catch (error) {
                console.error('Failed to fetch featured level:', error);
            }
        }

        function displayFeaturedLevel(level, isWeekly) {
            featuredLevelId = level.id;

            const container = document.getElementById('featuredLevel');
            const label = document.getElementById('featuredLabel');
            const thumb = document.getElementById('featuredThumb');
            const title = document.getElementById('featuredTitle');
            const author = document.getElementById('featuredAuthor');
            const difficulty = document.getElementById('featuredDifficulty');
            const likes = document.getElementById('featuredLikes');
            const playBtn = document.getElementById('featuredPlayBtn');

            // Update label based on weekly or all-time
            label.textContent = isWeekly
                ? "üèÜ This Week's Most Popular Level:"
                : "üèÜ Community Favorite:";

            // Set thumbnail
            if (level.thumbnail_url) {
                thumb.src = level.thumbnail_url;
            } else {
                thumb.src = 'logo.png'; // Fallback
            }

            title.textContent = level.title || 'Untitled Level';
            author.textContent = 'by ' + (level.author_name || 'Anonymous');

            // Set difficulty with appropriate styling
            const diff = (level.difficulty || 'medium').toLowerCase();
            difficulty.textContent = diff.charAt(0).toUpperCase() + diff.slice(1);
            difficulty.className = 'difficulty-badge ' + diff;

            likes.textContent = '‚ù§Ô∏è ' + (level.likes_count || 0);

            // Play button click handler
            playBtn.onclick = () => playFeaturedLevel(level.id);

            container.style.display = 'block';
        }

        function playFeaturedLevel(levelId) {
            const userAgent = navigator.userAgent.toLowerCase();
            const isAndroid = userAgent.includes('android');
            const isIOS = /iphone|ipad|ipod/.test(userAgent);

            const levelTitle = document.getElementById('featuredTitle').textContent;

            if (isAndroid) {
                // Open the Play Store
                window.location.href = 'https://play.google.com/store/apps/details?id=com.nick.aquaducked';
            } else if (isIOS) {
                alert('AquaDucked! is coming soon to iOS!');
            } else {
                // Desktop - show friendly message
                alert('Download AquaDucked! on your mobile device, then find "' + levelTitle + '" in The Pond!');
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            checkForLevelLink();
            updateDownloadButton();
            fetchFeaturedLevel();
        });
    </script>
</body>
</html>
